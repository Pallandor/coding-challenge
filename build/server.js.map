{"version":3,"sources":["webpack:///webpack/bootstrap 9eeb081e419a472646b1","webpack:///./server/index.js","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"dotenv\"","webpack:///external \"winston\"","webpack:///external \"helmet\"","webpack:///./server/util.js","webpack:///./server/routers/api.js","webpack:///./server/routes/tvshow/index.js","webpack:///./server/routes/tvshow/helpers.js","webpack:///./server/controllers/api/tvshow.js","webpack:///external \"bluebird\"","webpack:///./server/routes/config.js"],"names":["express","require","bodyParser","dotenv","winston","helmet","util","process","env","NODE_ENV","load","path","app","PORT","use","json","apiRouter","reportBadJSON","listen","err","error","info","module","exports","req","res","next","SyntaxError","status","send","hasDeepEqualKeys","obj1","obj2","Array","isArray","length","every","obj1El","obj1Key","obj1Keys","Object","keys","obj2Keys","hasOwnProperty","Router","tvshowRoutes","get","getShows","post","postShowsToFilter","helpers","showController","testResponse","shows","body","payload","filterShowsByPredicate","then","sanitiseShows","filteredShows","sendShows","sanitisedShows","catch","console","log","aTestResponse","response","Promise","config","predicate","defaultTvShowFilterPredicate","resolve","filter","transform","defaultTvShowSanitiser","map","validateShows","expectedShowObjShape","defaultExpectedShowShape","show","drm","episodeCount","image","showImage","slug","title"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9eeb081e419a472646b1\n **/","'use strict';\n\nconst express = require('express');\nconst bodyParser = require('body-parser');\nconst dotenv = require('dotenv');\nconst winston = require('winston');\nconst helmet = require('helmet');\n\nconst util = require('./util');\n\n/** Load environment variables from .env file if dev mode **/\nif (process.env.NODE_ENV === 'development') {\n  dotenv.load({ path: '.env' });\n}\n\n/** Create Express Server **/\nconst app = express();\nconst PORT = process.env.PORT || 8080;\n\n/** Server config **/\napp.use(bodyParser.json());\napp.use(helmet());\n\n/** Express Routers **/\nconst apiRouter = require('./routers/api');\n\n/** Install Express Routers **/\napp.use('/api', apiRouter);\n\n/** Custom Express Error Middleware **/\napp.use(util.reportBadJSON());\n\n/** Start Server **/\napp.listen(PORT, (err) => {\n  if (err) {\n    winston.error(err);\n    return;\n  }\n  winston.info(`Listening on port ${PORT}`);\n});\n\nmodule.exports = app;\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/index.js\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"dotenv\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"dotenv\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"winston\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"winston\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"helmet\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"helmet\"\n ** module id = 5\n ** module chunks = 0\n **/","'use strict';\n\n/** Server, middleware and general utils **/\n\n/** Express error middleware creator to parse body-parser error objects and report bad JSON **/\n// eslint-disable-next-line no-unused-vars\nexports.reportBadJSON = () => (err, req, res, next) => {\n  if (err instanceof SyntaxError && err.status === 400 && 'body' in err) {\n    res.status(400).send({\n      error: 'Could not decode request: JSON parsing failed',\n    });\n  }\n};\n\n/** Recursive object shape validator by keys **/\nexports.hasDeepEqualKeys = (obj1, obj2) => {\n  if (Array.isArray(obj1)) {\n    if (Array.isArray(obj2)) {\n      if (obj1.length !== obj2.length) {\n        return false;\n      }\n      return obj1.every((obj1El, obj1Key) => {\n        if (typeof obj1El === 'object' && obj1El !== null) {\n          if (typeof obj2[obj1Key] === 'object' && obj2[obj1Key] !== null) {\n            return exports.hasDeepEqualKeys(obj1El, obj2[obj1Key]);\n          }\n          return false;\n        }\n        if (typeof obj2[obj1Key] === 'object' && obj2[obj1Key] !== null) {\n          return false; // only here if first is not an object\n        }\n        return true; // arrays hold numeric indices, length is sufficient validation\n      });\n    }\n    return false;\n  }\n  if (Array.isArray(obj2)) {\n    return false; // only here if first is not an array\n  }\n  if (typeof obj1 === 'object' && typeof obj2 === 'object' && obj1 !== null && obj2 !== null) {\n    const obj1Keys = Object.keys(obj1);\n    const obj2Keys = Object.keys(obj2);\n    if (obj1Keys.length !== obj2Keys.length) {\n      return false;\n    }\n    return obj1Keys.every(obj1Key => {\n      if (typeof obj1[obj1Key] === 'object' && obj1[obj1Key] !== null) {\n        if (typeof obj2[obj1Key] === 'object' && obj2[obj1Key] !== null) {\n          return exports.hasDeepEqualKeys(obj1[obj1Key], obj2[obj1Key]);\n        }\n        return false;\n      }\n      if (typeof obj2[obj1Key] === 'object' && obj2[obj1Key] !== null) {\n        return false; // only here if first is non-object\n      }\n      return obj2.hasOwnProperty(obj1Key);\n    });\n  }\n  return false;\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/util.js\n **/","'use strict';\n\n/** API Router **/\n\nconst express = require('express');\nconst apiRouter = express.Router();\n\n/** Route handlers **/\nconst tvshowRoutes = require('../routes/tvshow');\n\n/** Install API routes **/\napiRouter.get('/tvshow', tvshowRoutes.getShows);\napiRouter.post('/tvshow/filter', tvshowRoutes.postShowsToFilter);\n\nmodule.exports = apiRouter;\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routers/api.js\n **/","'use strict';\n\nconst helpers = require('./helpers');\nconst showController = require('../../controllers/api/tvshow');\n\n/** API Route Handlers **/\n\nexports.getShows = (req, res) => {\n  helpers.testResponse(res);\n};\n\nexports.postShowsToFilter = (req, res) => {\n  const shows = req.body.payload;\n  showController\n    .filterShowsByPredicate(shows)\n    .then(filteredShows => showController.sanitiseShows(filteredShows)) // try as func that takes promise?\n    //.then(sanitiseShows)\n    .then(sanitisedShows => {\n      helpers.sendShows(res, sanitisedShows);\n    })\n    .catch(err => console.log(err)); // TODO: Modify express error-handler middleware\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/tvshow/index.js\n **/","'use strict';\n\n/** Route specific helpers, which are aware of server state e.g. res object.\n    So do NOT cast to promises.\n**/\n\nexports.testResponse = res => res.status(200).json({aTestResponse: 'fromTvShowHelpers'});\n\nexports.sendShows = (res, shows) => {\n  res.status(200).json({\n    response: shows,\n  });\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/tvshow/helpers.js\n **/","'use strict';\n\nconst Promise = require('bluebird');\nconst config = require('../../routes/config');\nconst util = require('../../util');\n\n// NOTE: Cast synchronous values to promises too, keep contract of controllers resolving to promises\n\n/** Filter TV shows by predicate if given or default predicate from /routes config **/\nexports.filterShowsByPredicate = (shows, predicate = config.defaultTvShowFilterPredicate) =>\n  Promise.resolve(shows.filter(predicate));\n\n/** Transform show objects to desired shape, will default to shape defined in /routes config **/\nexports.sanitiseShows = (shows, transform = config.defaultTvShowSanitiser) =>\n  Promise.resolve(shows.map(transform));\n\n// Pointless validator, objects in payload don't conform to a standard shape :(\n// NOTE: Potential use in future API extensions though\nexports.validateShows = (shows, expectedShowObjShape = config.defaultExpectedShowShape) =>\n  Promise.resolve(util.hasDeepEqualKeys(shows, expectedShowObjShape));\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/controllers/api/tvshow.js\n **/","module.exports = require(\"bluebird\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bluebird\"\n ** module id = 11\n ** module chunks = 0\n **/","'use strict';\n\n/** Config for: api/tvshow/filter **/\nexports.defaultTvShowFilterPredicate = show => show.drm && show.episodeCount;\n\nexports.defaultTvShowSanitiser = show => ({\n  image: show.image && show.image.showImage || null,\n  slug: show.slug || null,\n  title: show.title || null,\n});\n\nexports.defaultExpectedShowShape = {};\n    // {\n    //      \"country\": \"UK\",\n    //      \"description\": \"What's life like when you have enough children to field your own football team?\",\n    //      \"drm\": true,\n    //      \"episodeCount\": 3,\n    //      \"genre\": \"Reality\",\n    //      \"image\": {\n    //          \"showImage\": \"http://mybeautifulcatchupservice.com/img/shows/16KidsandCounting1280.jpg\"\n    //      },\n    //      \"language\": \"English\",\n    //      \"nextEpisode\": null,\n    //      \"primaryColour\": \"#ff7800\",\n    //      \"seasons\": [\n    //          {\n    //              \"slug\": \"show/16kidsandcounting/season/1\"\n    //          }\n    //      ],\n    //      \"slug\": \"show/16kidsandcounting\",\n    //      \"title\": \"16 Kids and Counting\",\n    //      \"tvChannel\": \"GEM\"\n    //  };\n\n\n\n/** WEBPACK FOOTER **\n ** ./server/routes/config.js\n **/"],"sourceRoot":""}